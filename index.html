<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Avaliações</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
      :root {
        --primary-color: #5a7dff;
        --secondary-color: #8faaff;
        --accent-color: #17c3b2;
        --text-color: #f0f2f5;
        --card-bg: rgba(30, 39, 50, 0.85);
        --hover-effect: rgba(90, 125, 255, 0.2);
        --success-color: #00b894;
        --danger-color: #ff6b6b;
        --warning-color: #feca57;
        --export-color: #00b894;
        --ranking-color: #feca57;
        --form-color: #5a7dff;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #2c3e50, #1a1a2e);
        color: var(--text-color);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--accent-color)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        display: inline-block;
      }

      .subtitle {
        color: var(--secondary-color);
        font-size: 1.2rem;
      }

      .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .card {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.3s ease;
        cursor: pointer;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
        background: rgba(40, 50, 60, 0.9);
      }

      .card.disabled {
        opacity: 0.6;
        cursor: not-allowed;
        pointer-events: none;
      }

      .card i {
        font-size: 3rem;
        margin-bottom: 15px;
      }

      .card.primary i {
        color: var(--secondary-color);
      }

      .card.export i {
        color: var(--export-color);
      }

      .card.ranking i {
        color: var(--ranking-color);
      }

      .card.form i {
        color: var(--form-color);
      }

      .card h3 {
        font-size: 1.5rem;
        margin-bottom: 10px;
      }

      .card p {
        color: #dfe6e9;
        font-size: 0.9rem;
      }

      .section {
        display: none;
        background: var(--card-bg);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }

      .active {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h2 {
        font-size: 2rem;
        margin-bottom: 20px;
        color: var(--secondary-color);
      }

      .back-btn {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 50px;
        cursor: pointer;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background 0.3s ease;
      }

      .back-btn:hover {
        background: var(--accent-color);
      }

      form {
        display: grid;
        gap: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      label {
        font-weight: bold;
        color: var(--secondary-color);
      }

      input,
      select,
      textarea {
        padding: 12px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(0, 0, 0, 0.2);
        color: var(--text-color);
        font-size: 1rem;
      }

      button {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: bold;
        transition: background 0.3s ease, transform 0.2s ease;
      }

      button:hover {
        background: var(--accent-color);
        transform: translateY(-2px);
      }

      .question-item,
      .student-item {
        background: rgba(0, 0, 0, 0.2);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .tab {
        padding: 10px 20px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s ease;
      }

      .tab.active {
        background: var(--primary-color);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .chart-container {
        position: relative;
        height: 400px;
        margin-top: 20px;
      }

      .danger-btn {
        background: var(--danger-color);
      }

      .danger-btn:hover {
        background: #ff7675;
      }

      .student-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .student-card {
        background: rgba(0, 0, 0, 0.2);
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid var(--accent-color);
      }

      .status-badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        margin-top: 10px;
      }

      .status-correct {
        background: var(--success-color);
      }

      .status-wrong {
        background: var(--danger-color);
      }

      .student-count {
        margin: 15px 0;
        padding: 10px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        text-align: center;
      }

      .ranking-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        overflow: hidden;
      }

      .ranking-table th,
      .ranking-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .ranking-table th {
        background-color: var(--primary-color);
        color: white;
      }

      .ranking-table tr:hover {
        background-color: rgba(255, 255, 255, 0.05);
      }

      .ranking-table tr:nth-child(even) {
        background-color: rgba(0, 0, 0, 0.1);
      }

      .medal {
        display: inline-block;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        text-align: center;
        line-height: 25px;
        margin-right: 10px;
        font-weight: bold;
      }

      .gold {
        background: linear-gradient(145deg, #ffd700, #daa520);
        color: black;
      }

      .silver {
        background: linear-gradient(145deg, #c0c0c0, #a9a9a9);
        color: black;
      }

      .bronze {
        background: linear-gradient(145deg, #cd7f32, #8c6b46);
        color: white;
      }

      .link-box {
        background: rgba(0, 0, 0, 0.2);
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .link-box input {
        flex: 1;
        background: rgba(255, 255, 255, 0.1);
      }

      .copy-btn {
        background: var(--accent-color);
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s ease;
      }

      .copy-btn:hover {
        background: var(--primary-color);
      }

      .form-preview {
        background: rgba(0, 0, 0, 0.2);
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
      }

      .question-preview {
        background: rgba(255, 255, 255, 0.05);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
      }

      .options-container {
        display: grid;
        gap: 10px;
        margin-top: 10px;
      }

      .option-item {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      @media (max-width: 768px) {
        .dashboard {
          grid-template-columns: 1fr;
        }

        .tabs {
          flex-direction: column;
        }

        .student-list {
          grid-template-columns: 1fr;
        }

        .link-box {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1><i class="fas fa-graduation-cap"></i> Sistema de Avaliações</h1>
        <p class="subtitle">
          Gerencie avaliações, gabaritos e resultados de forma eficiente
        </p>
      </header>

      <main>
        <section id="dashboard" class="section active">
          <div class="dashboard">
            <div
              class="card primary"
              onclick="showSection('create-assessment')"
            >
              <i class="fas fa-plus-circle"></i>
              <h3>Criar Avaliação</h3>
              <p>
                Defina uma nova avaliação com nome, quantidade de questões e
                assuntos
              </p>
            </div>

            <div
              id="card-insert-key"
              class="card primary disabled"
              onclick="showSection('insert-key')"
            >
              <i class="fas fa-key"></i>
              <h3>Inserir Gabarito</h3>
              <p>Defina as respostas corretas para cada questão da avaliação</p>
            </div>

            <div
              id="card-student-answers"
              class="card primary disabled"
              onclick="showSection('student-answers')"
            >
              <i class="fas fa-user-graduate"></i>
              <h3>Respostas dos Alunos</h3>
              <p>
                Registre as respostas dos alunos para cada questão (até 50
                alunos)
              </p>
            </div>

            <div
              id="card-results"
              class="card primary disabled"
              onclick="showSection('results')"
            >
              <i class="fas fa-chart-bar"></i>
              <h3>Resultados</h3>
              <p>Visualize análises detalhadas por questão, assunto e aluno</p>
            </div>

            <div
              id="card-manage-data"
              class="card primary"
              onclick="showSection('manage-data')"
            >
              <i class="fas fa-database"></i>
              <h3>Gerenciar Dados</h3>
              <p>Apague todos os dados para iniciar uma nova avaliação</p>
            </div>

            <div
              id="card-export-pdf"
              class="card export disabled"
              onclick="exportToPDF()"
            >
              <i class="fas fa-file-pdf"></i>
              <h3>Exportar PDF</h3>
              <p>
                Gere um relatório completo em PDF com todos os dados da
                avaliação
              </p>
            </div>

            <div
              id="card-ranking"
              class="card ranking disabled"
              onclick="showSection('ranking')"
            >
              <i class="fas fa-trophy"></i>
              <h3>Ranking da Turma</h3>
              <p>
                Visualize o ranking completo de alunos ordenados por desempenho
              </p>
            </div>

            <div
              id="card-online-form"
              class="card form disabled"
              onclick="showSection('online-form')"
            >
              <i class="fas fa-file-alt"></i>
              <h3>Formulário Online</h3>
              <p>
                Crie uma avaliação online para os alunos responderem diretamente
                no navegador
              </p>
            </div>
          </div>
        </section>

        <section id="create-assessment" class="section">
          <button class="back-btn" onclick="showSection('dashboard')">
            <i class="fas fa-arrow-left"></i> Voltar
          </button>
          <h2><i class="fas fa-plus-circle"></i> Criar Nova Avaliação</h2>

          <form id="assessment-form">
            <div class="form-group">
              <label for="assessment-name">Nome da Avaliação</label>
              <input
                type="text"
                id="assessment-name"
                required
                placeholder="Ex: Projeto Integrador - Módulo 1"
              />
            </div>

            <div class="form-group">
              <label for="questions-count">Quantidade de Questões (1-50)</label>
              <input
                type="number"
                id="questions-count"
                min="1"
                max="50"
                required
              />
            </div>

            <div id="questions-container"></div>

            <button type="submit">Salvar Avaliação</button>
          </form>
        </section>

        <section id="insert-key" class="section">
          <button class="back-btn" onclick="showSection('dashboard')">
            <i class="fas fa-arrow-left"></i> Voltar
          </button>
          <h2><i class="fas fa-key"></i> Inserir Gabarito</h2>

          <div id="key-container"></div>

          <button id="save-key-btn">Salvar Gabarito</button>
        </section>

        <section id="student-answers" class="section">
          <button class="back-btn" onclick="showSection('dashboard')">
            <i class="fas fa-arrow-left"></i> Voltar
          </button>
          <h2><i class="fas fa-user-graduate"></i> Respostas dos Alunos</h2>

          <div class="student-count" id="student-count">
            Nenhum aluno cadastrado ainda. Máximo: 50 alunos.
          </div>

          <form id="student-form">
            <div class="form-group">
              <label for="student-name">Nome do Aluno</label>
              <input
                type="text"
                id="student-name"
                required
                placeholder="Ex: João Silva"
              />
            </div>

            <div id="answers-container"></div>

            <button type="submit">Salvar Respostas</button>
          </form>

          <div id="students-list-container" style="margin-top: 30px">
            <h3>Alunos Cadastrados</h3>
            <div id="students-list" class="student-list"></div>
          </div>
        </section>

        <section id="results" class="section">
          <button class="back-btn" onclick="showSection('dashboard')">
            <i class="fas fa-arrow-left"></i> Voltar
          </button>
          <h2><i class="fas fa-chart-bar"></i> Resultados</h2>

          <div class="tabs">
            <div class="tab active" data-tab="question-tab">Por Questão</div>
            <div class="tab" data-tab="subject-tab">Por Assunto</div>
            <div class="tab" data-tab="student-tab">Por Aluno</div>
          </div>

          <div id="question-tab" class="tab-content active">
            <h3>Desempenho por Questão</h3>
            <div class="chart-container">
              <canvas id="question-chart"></canvas>
            </div>
          </div>

          <div id="subject-tab" class="tab-content">
            <h3>Desempenho por Assunto</h3>
            <div class="chart-container">
              <canvas id="subject-chart"></canvas>
            </div>
          </div>

          <div id="student-tab" class="tab-content">
            <h3>Desempenho por Aluno</h3>
            <div class="chart-container">
              <canvas id="student-chart"></canvas>
            </div>

            <div id="student-details" style="margin-top: 30px"></div>
          </div>
        </section>

        <section id="ranking" class="section">
          <button class="back-btn" onclick="showSection('dashboard')">
            <i class="fas fa-arrow-left"></i> Voltar
          </button>
          <h2><i class="fas fa-trophy"></i> Ranking da Turma</h2>

          <div id="ranking-container"></div>
        </section>

        <section id="online-form" class="section">
          <button class="back-btn" onclick="showSection('dashboard')">
            <i class="fas fa-arrow-left"></i> Voltar
          </button>
          <h2><i class="fas fa-file-alt"></i> Formulário Online</h2>

          <div id="form-generator">
            <p>
              Crie um formulário online para que seus alunos possam responder a
              avaliação diretamente pelo navegador.
            </p>

            <div class="form-group">
              <label for="form-title">Título do Formulário</label>
              <input
                type="text"
                id="form-title"
                placeholder="Ex: Avaliação de Matemática"
                value="Avaliação Online"
              />
            </div>

            <div class="form-group">
              <label for="form-description">Descrição/Instruções</label>
              <textarea
                id="form-description"
                rows="3"
                placeholder="Digite as instruções para os alunos"
              >
Preencha o formulário com suas respostas. Cada questão vale 1 ponto.</textarea
              >
            </div>

            <div class="form-group">
              <label for="form-require-name">Solicitar nome do aluno</label>
              <select id="form-require-name">
                <option value="yes">Sim</option>
                <option value="no">Não</option>
              </select>
            </div>

            <button id="generate-form-btn">Gerar Formulário Online</button>

            <div
              id="form-link-container"
              style="display: none; margin-top: 20px"
            >
              <h3>Link do Formulário</h3>
              <p>
                Compartilhe este link com seus alunos para que possam responder
                a avaliação:
              </p>

              <div class="link-box">
                <input type="text" id="form-link" readonly />
                <div class="copy-btn" onclick="copyFormLink()">
                  <i class="fas fa-copy"></i> Copiar
                </div>
              </div>

              <div class="form-preview">
                <h3>Pré-visualização do Formulário</h3>
                <div id="form-preview-container"></div>
              </div>
            </div>
          </div>
        </section>

        <section id="manage-data" class="section">
          <button class="back-btn" onclick="showSection('dashboard')">
            <i class="fas fa-arrow-left"></i> Voltar
          </button>
          <h2><i class="fas fa-database"></i> Gerenciamento de Dados</h2>

          <p>
            Esta ação irá apagar todos os dados das avaliações, gabaritos e
            respostas dos alunos.
          </p>
          <p>Tem certeza que deseja continuar?</p>

          <button id="clear-data-btn" class="danger-btn">
            Apagar Todos os Dados
          </button>

          <div
            style="
              margin-top: 30px;
              padding: 15px;
              background: rgba(0, 0, 0, 0.2);
              border-radius: 8px;
            "
          >
            <h3>Status do Sistema</h3>
            <p id="status-assessment">Avaliação: Não configurada</p>
            <p id="status-key">Gabarito: Não definido</p>
            <p id="status-students">Alunos cadastrados: 0</p>
          </div>
        </section>
      </main>
    </div>

    <script>
      // === Variáveis Globais e Instâncias de Gráficos ===
      let currentAssessment = null;
      let answerKey = null;
      let studentAnswers = [];
      let onlineFormLink = "";
      let questionChartInstance, subjectChartInstance, studentChartInstance;

      // URL base da sua API
      // Quando estiver online, substitua 'http://localhost:3000' pela URL do seu servidor
      const API_URL = "http://localhost:3000/api";

      // === Elementos do DOM ===
      const questionsContainer = document.getElementById("questions-container");
      const keyContainer = document.getElementById("key-container");
      const answersContainer = document.getElementById("answers-container");
      const assessmentForm = document.getElementById("assessment-form");
      const studentForm = document.getElementById("student-form");
      const saveKeyBtn = document.getElementById("save-key-btn");
      const clearDataBtn = document.getElementById("clear-data-btn");
      const studentsList = document.getElementById("students-list");
      const studentCount = document.getElementById("student-count");
      const studentDetails = document.getElementById("student-details");
      const rankingContainer = document.getElementById("ranking-container");
      const generateFormBtn = document.getElementById("generate-form-btn");
      const formLinkContainer = document.getElementById("form-link-container");
      const formLink = document.getElementById("form-link");
      const formPreviewContainer = document.getElementById(
        "form-preview-container"
      );
      const tabButtons = document.querySelectorAll(".tab");

      // === Inicialização e Event Listeners ===
      document.addEventListener("DOMContentLoaded", () => {
        initialize();
      });

      async function initialize() {
        await fetchInitialData();
        updateDashboardCards();
        updateStatus();

        assessmentForm.addEventListener("submit", handleAssessmentSubmit);
        studentForm.addEventListener("submit", handleStudentSubmit);
        saveKeyBtn.addEventListener("click", handleSaveKey);
        clearDataBtn.addEventListener("click", handleClearData);
        generateFormBtn.addEventListener("click", generateOnlineForm);
        document
          .getElementById("questions-count")
          .addEventListener("input", generateQuestionFields);

        tabButtons.forEach((tab) => {
          tab.addEventListener("click", handleTabClick);
        });
      }

      // --- Função principal para carregar os dados do backend ---
      async function fetchInitialData() {
        try {
          const response = await fetch(`${API_URL}/all-data`);
          if (!response.ok)
            throw new Error("Não foi possível carregar os dados.");
          const data = await response.json();

          currentAssessment = data.assessment;
          answerKey = data.answerKey;
          studentAnswers = data.studentAnswers;
        } catch (error) {
          console.error("Erro ao carregar dados iniciais:", error);
          // Permite o uso da página mesmo sem o backend conectado
        }
      }

      function handleTabClick(event) {
        const tabId = event.target.getAttribute("data-tab");
        changeTab(tabId, event.target);
      }

      // === Funções de Navegação e UI ===
      function showSection(sectionId) {
        const sections = document.querySelectorAll(".section");
        sections.forEach((section) => section.classList.remove("active"));
        document.getElementById(sectionId).classList.add("active");

        if (sectionId === "insert-key") generateKeyFields();
        if (sectionId === "student-answers") {
          generateAnswerFields();
          renderStudentsList();
          updateStudentCount();
        }
        if (sectionId === "results") {
          renderQuestionChart();
          renderStudentDetails();
        }
        if (sectionId === "ranking") renderRanking();
        if (sectionId === "manage-data") updateStatus();
      }

      function changeTab(tabId, clickedTab) {
        tabButtons.forEach((tab) => tab.classList.remove("active"));
        document
          .querySelectorAll(".tab-content")
          .forEach((content) => content.classList.remove("active"));

        clickedTab.classList.add("active");
        document.getElementById(tabId).classList.add("active");

        if (tabId === "question-tab") renderQuestionChart();
        if (tabId === "subject-tab") renderSubjectChart();
        if (tabId === "student-tab") {
          renderStudentChart();
          renderStudentDetails();
        }
      }

      function updateDashboardCards() {
        const cardsToDisable = {
          "card-insert-key": !currentAssessment,
          "card-student-answers": !currentAssessment || !answerKey,
          "card-results":
            !currentAssessment || !answerKey || studentAnswers.length === 0,
          "card-export-pdf":
            !currentAssessment || !answerKey || studentAnswers.length === 0,
          "card-ranking":
            !currentAssessment || !answerKey || studentAnswers.length === 0,
          "card-online-form": !currentAssessment || !answerKey,
        };

        for (const id in cardsToDisable) {
          const card = document.getElementById(id);
          if (cardsToDisable[id]) {
            card.classList.add("disabled");
          } else {
            card.classList.remove("disabled");
          }
        }
      }

      function updateStatus() {
        document.getElementById(
          "status-assessment"
        ).textContent = `Avaliação: ${
          currentAssessment ? currentAssessment.name : "Não configurada"
        }`;
        document.getElementById("status-key").textContent = `Gabarito: ${
          answerKey ? "Definido" : "Não definido"
        }`;
        document.getElementById(
          "status-students"
        ).textContent = `Alunos cadastrados: ${studentAnswers.length}`;
      }

      // === Gerenciamento de Avaliação e Gabarito ===
      function generateQuestionFields() {
        const questionsCount =
          parseInt(document.getElementById("questions-count").value) || 0;
        questionsContainer.innerHTML = "";
        for (let i = 1; i <= questionsCount; i++) {
          const questionDiv = document.createElement("div");
          questionDiv.className = "form-group";
          questionDiv.innerHTML = `
                    <label for="question-${i}">Questão ${i} - Assunto</label>
                    <input type="text" id="question-${i}" required placeholder="Ex: Matemática Básica">
                `;
          questionsContainer.appendChild(questionDiv);
        }
      }

      async function handleAssessmentSubmit(e) {
        e.preventDefault();
        const assessmentName = document.getElementById("assessment-name").value;
        const questionsCount = parseInt(
          document.getElementById("questions-count").value
        );
        const questions = [];
        for (let i = 1; i <= questionsCount; i++) {
          const subject = document.getElementById(`question-${i}`).value.trim();
          if (!subject) {
            alert(`Por favor, preencha o assunto da questão ${i}.`);
            return;
          }
          questions.push({ number: i, subject });
        }

        const assessmentData = {
          name: assessmentName,
          questionsCount,
          questions,
        };

        try {
          const response = await fetch(`${API_URL}/assessments`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(assessmentData),
          });
          const newAssessment = await response.json();

          if (response.ok) {
            currentAssessment = newAssessment;
            alert("Avaliação salva com sucesso!");
            updateDashboardCards();
            showSection("dashboard");
          } else {
            alert(`Erro: ${newAssessment.error}`);
          }
        } catch (error) {
          alert("Erro ao conectar com o servidor.");
          console.error("Erro:", error);
        }
      }

      function generateKeyFields() {
        if (!currentAssessment) {
          keyContainer.innerHTML =
            '<p>Primeiro crie uma avaliação na seção "Criar Avaliação".</p>';
          return;
        }
        keyContainer.innerHTML =
          "<h3>Defina a alternativa correta para cada questão:</h3>";
        currentAssessment.questions.forEach((question) => {
          const keyDiv = document.createElement("div");
          keyDiv.className = "form-group";
          keyDiv.innerHTML = `
                    <label for="key-${question.number}">Questão ${question.number} - ${question.subject}</label>
                    <select id="key-${question.number}" required>
                        <option value="">Selecione a alternativa correta</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                `;
          keyContainer.appendChild(keyDiv);
          if (answerKey) {
            const savedKey = answerKey.find(
              (k) => k.questionNumber === question.number
            );
            if (savedKey)
              document.getElementById(`key-${question.number}`).value =
                savedKey.correctAnswer;
          }
        });
      }

      async function handleSaveKey() {
        if (!currentAssessment) {
          alert("Primeiro crie uma avaliação.");
          return;
        }
        const key = [];
        for (let i = 1; i <= currentAssessment.questionsCount; i++) {
          const correctAnswer = document.getElementById(`key-${i}`).value;
          if (!correctAnswer) {
            alert(
              `Por favor, selecione a alternativa correta para a questão ${i}.`
            );
            return;
          }
          key.push({
            questionNumber: i,
            correctAnswer,
            subject: currentAssessment.questions.find((q) => q.number === i)
              .subject,
          });
        }

        const keyData = { assessmentId: currentAssessment._id, answers: key };

        try {
          const response = await fetch(`${API_URL}/answer-keys`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(keyData),
          });
          const newKey = await response.json();

          if (response.ok) {
            answerKey = newKey;
            alert("Gabarito salvo com sucesso!");
            updateDashboardCards();
            showSection("dashboard");
          } else {
            alert(`Erro: ${newKey.error}`);
          }
        } catch (error) {
          alert("Erro ao conectar com o servidor.");
          console.error("Erro:", error);
        }
      }

      // === Gerenciamento de Respostas dos Alunos ===
      function generateAnswerFields() {
        if (!currentAssessment || !answerKey) {
          answersContainer.innerHTML =
            "<p>Crie uma avaliação e defina o gabarito primeiro.</p>";
          return;
        }
        answersContainer.innerHTML =
          "<h3>Respostas do aluno para cada questão:</h3>";
        currentAssessment.questions.forEach((question) => {
          const answerDiv = document.createElement("div");
          answerDiv.className = "form-group";
          answerDiv.innerHTML = `
                    <label for="answer-${question.number}">Questão ${question.number} - ${question.subject}</label>
                    <select id="answer-${question.number}" required>
                        <option value="">Selecione a alternativa</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                `;
          answersContainer.appendChild(answerDiv);
        });
      }

      async function handleStudentSubmit(e) {
        e.preventDefault();
        if (studentAnswers.length >= 50) {
          alert("Limite máximo de 50 alunos atingido.");
          return;
        }

        const studentName = document
          .getElementById("student-name")
          .value.trim();
        if (
          studentAnswers.some(
            (student) =>
              student.studentName.toLowerCase() === studentName.toLowerCase()
          )
        ) {
          alert("Já existe um aluno com este nome.");
          return;
        }

        const answers = [];
        for (let i = 1; i <= currentAssessment.questionsCount; i++) {
          const answer = document.getElementById(`answer-${i}`).value;
          if (!answer) {
            alert(`Por favor, selecione uma alternativa para a questão ${i}.`);
            return;
          }
          const isCorrect =
            answer ===
            answerKey.find((k) => k.questionNumber === i).correctAnswer;
          answers.push({
            questionNumber: i,
            answer,
            isCorrect,
            subject: currentAssessment.questions.find((q) => q.number === i)
              .subject,
          });
        }

        const studentData = {
          assessmentId: currentAssessment._id,
          studentName,
          answers,
        };

        try {
          const response = await fetch(`${API_URL}/student-answers`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(studentData),
          });
          const newStudent = await response.json();

          if (response.ok) {
            studentAnswers.push(newStudent);
            alert("Respostas do aluno salvas com sucesso!");
            studentForm.reset();
            updateStudentCount();
            renderStudentsList();
            updateDashboardCards();
          } else {
            alert(`Erro: ${newStudent.error}`);
          }
        } catch (error) {
          alert("Erro ao conectar com o servidor.");
          console.error("Erro:", error);
        }
      }

      function renderStudentsList() {
        if (!currentAssessment || studentAnswers.length === 0) {
          studentsList.innerHTML = "<p>Nenhum aluno cadastrado ainda.</p>";
          return;
        }
        studentsList.innerHTML = "";
        studentAnswers.forEach((student) => {
          const correctAnswers = student.answers.filter(
            (answer) => answer.isCorrect
          ).length;
          const totalQuestions = currentAssessment.questionsCount;
          const score = (correctAnswers / totalQuestions) * 100;

          const studentCard = document.createElement("div");
          studentCard.className = "student-card";
          studentCard.innerHTML = `
                    <h4>${student.studentName}</h4>
                    <p>Acertos: ${correctAnswers}/${totalQuestions}</p>
                    <p>Nota: ${score.toFixed(1)}%</p>
                    <span class="status-badge ${
                      score >= 60 ? "status-correct" : "status-wrong"
                    }">
                        ${score >= 60 ? "Aprovado" : "Reprovado"}
                    </span>
                `;
          studentsList.appendChild(studentCard);
        });
      }

      function updateStudentCount() {
        const countMessage = currentAssessment
          ? `Alunos cadastrados: ${studentAnswers.length}/50`
          : "Crie uma avaliação para registrar alunos.";
        studentCount.textContent = countMessage;
        if (studentAnswers.length >= 50) {
          studentCount.innerHTML +=
            " - <strong>Limite máximo atingido</strong>";
        }
      }

      // === Gerenciamento de Dados e Limpeza ===
      async function handleClearData() {
        if (
          confirm(
            "Tem certeza que deseja apagar TODOS os dados? Esta ação não pode ser desfeita."
          )
        ) {
          try {
            const response = await fetch(`${API_URL}/clear-data`, {
              method: "DELETE",
            });
            const result = await response.json();

            if (response.ok) {
              currentAssessment = null;
              answerKey = null;
              studentAnswers = [];
              onlineFormLink = "";
              alert("Todos os dados foram apagados.");
              updateDashboardCards();
              updateStatus();
              showSection("dashboard");
              document.getElementById("assessment-form").reset();
              questionsContainer.innerHTML = "";
              keyContainer.innerHTML = "";
              answersContainer.innerHTML = "";
              studentsList.innerHTML = "";
              formLinkContainer.style.display = "none";
              formPreviewContainer.innerHTML = "";
            } else {
              alert(`Erro: ${result.error}`);
            }
          } catch (error) {
            alert("Erro ao conectar com o servidor.");
            console.error("Erro:", error);
          }
        }
      }

      // === Relatórios e Gráficos ===
      function exportToPDF() {
        if (!currentAssessment || !answerKey || studentAnswers.length === 0) {
          alert("Não há dados de alunos para gerar um relatório.");
          return;
        }

        const reportElement = document.createElement("div");
        reportElement.style.padding = "20px";
        reportElement.style.backgroundColor = "white";
        reportElement.style.color = "black";
        reportElement.style.fontFamily = "Arial, sans-serif";
        reportElement.innerHTML = `
                <h1 style="text-align: center; color: var(--primary-color);">Relatório de Avaliação</h1>
                <h2 style="color: var(--primary-color);">${
                  currentAssessment.name
                }</h2>
                <p><strong>Data do relatório:</strong> ${new Date().toLocaleDateString()}</p>
                <p><strong>Total de alunos:</strong> ${
                  studentAnswers.length
                }</p>
                <p><strong>Total de questões:</strong> ${
                  currentAssessment.questionsCount
                }</p>

                <h3 style="color: var(--primary-color); margin-top: 20px;">Desempenho Geral</h3>
                <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                    <div style="flex: 1; padding: 10px; background: #f1f2f6; border-radius: 5px; margin: 5px;">
                        <h4>Média da Turma</h4>
                        <p style="font-size: 24px; font-weight: bold;">${calculateAverageScore().toFixed(
                          1
                        )}%</p>
                    </div>
                    <div style="flex: 1; padding: 10px; background: #f1f2f6; border-radius: 5px; margin: 5px;">
                        <h4>Maior Nota</h4>
                        <p style="font-size: 24px; font-weight: bold;">${calculateMaxScore().toFixed(
                          1
                        )}%</p>
                    </div>
                    <div style="flex: 1; padding: 10px; background: #f1f2f6; border-radius: 5px; margin: 5px;">
                        <h4>Menor Nota</h4>
                        <p style="font-size: 24px; font-weight: bold;">${calculateMinScore().toFixed(
                          1
                        )}%</p>
                    </div>
                </div>

                <h3 style="color: var(--primary-color); margin-top: 20px;">Top 5 Alunos</h3>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <thead>
                        <tr style="background: var(--primary-color); color: white;">
                            <th style="padding: 10px; text-align: left;">Posição</th>
                            <th style="padding: 10px; text-align: left;">Aluno</th>
                            <th style="padding: 10px; text-align: left;">Nota</th>
                            <th style="padding: 10px; text-align: left;">Acertos</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${getTopStudents(5)
                          .map(
                            (student, index) => `
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 10px;">${index + 1}º</td>
                                <td style="padding: 10px;">${
                                  student.studentName
                                }</td>
                                <td style="padding: 10px;">${student.score.toFixed(
                                  1
                                )}%</td>
                                <td style="padding: 10px;">${
                                  student.correctAnswers
                                }/${currentAssessment.questionsCount}</td>
                            </tr>
                        `
                          )
                          .join("")}
                    </tbody>
                </table>

                <h3 style="color: var(--primary-color); margin-top: 20px;">Desempenho por Questão</h3>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <thead>
                        <tr style="background: var(--primary-color); color: white;">
                            <th style="padding: 10px; text-align: left;">Questão</th>
                            <th style="padding: 10px; text-align: left;">Assunto</th>
                            <th style="padding: 10px; text-align: left;">Taxa de Acerto</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${calculateQuestionPerformance()
                          .map(
                            (question, index) => `
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 10px;">${index + 1}</td>
                                <td style="padding: 10px;">${
                                  question.subject
                                }</td>
                                <td style="padding: 10px;">${question.accuracy.toFixed(
                                  1
                                )}%</td>
                            </tr>
                        `
                          )
                          .join("")}
                    </tbody>
                </table>
            `;

        document.body.appendChild(reportElement);

        html2canvas(reportElement).then((canvas) => {
          const imgData = canvas.toDataURL("image/png");
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF("p", "mm", "a4");
          const imgWidth = 210;
          const pageHeight = 295;
          const imgHeight = (canvas.height * imgWidth) / canvas.width;
          let heightLeft = imgHeight;
          let position = 0;

          pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;

          while (heightLeft >= 0) {
            position = heightLeft - imgHeight;
            pdf.addPage();
            pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
          }

          pdf.save(
            `relatorio-avaliacao-${currentAssessment.name
              .replace(/\s+/g, "-")
              .toLowerCase()}.pdf`
          );
          document.body.removeChild(reportElement);
        });
      }

      function renderRanking() {
        if (!currentAssessment || !answerKey || studentAnswers.length === 0) {
          rankingContainer.innerHTML =
            "<p>Não há dados suficientes para exibir o ranking. Adicione respostas de alunos.</p>";
          return;
        }

        const topStudents = getTopStudents(studentAnswers.length);

        rankingContainer.innerHTML = `
                <h3>Ranking de Desempenho</h3>
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th>Posição</th>
                            <th>Aluno</th>
                            <th>Nota</th>
                            <th>Acertos</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${topStudents
                          .map((student, index) => {
                            let medal = "";
                            if (index === 0)
                              medal = '<span class="medal gold">1º</span>';
                            else if (index === 1)
                              medal = '<span class="medal silver">2º</span>';
                            else if (index === 2)
                              medal = '<span class="medal bronze">3º</span>';
                            else medal = `<span>${index + 1}º</span>`;

                            return `
                                <tr>
                                    <td>${medal}</td>
                                    <td>${student.studentName}</td>
                                    <td>${student.score.toFixed(1)}%</td>
                                    <td>${student.correctAnswers}/${
                              currentAssessment.questionsCount
                            }</td>
                                    <td>
                                        <span class="status-badge ${
                                          student.score >= 60
                                            ? "status-correct"
                                            : "status-wrong"
                                        }">
                                            ${
                                              student.score >= 60
                                                ? "Aprovado"
                                                : "Reprovado"
                                            }
                                        </span>
                                    </td>
                                </tr>
                            `;
                          })
                          .join("")}
                    </tbody>
                </table>
            `;
      }

      // === Funções de Cálculo Auxiliares ===
      function calculateAverageScore() {
        if (studentAnswers.length === 0) return 0;
        const totalScore = studentAnswers.reduce(
          (sum, student) =>
            sum +
            (student.answers.filter((a) => a.isCorrect).length /
              currentAssessment.questionsCount) *
              100,
          0
        );
        return totalScore / studentAnswers.length;
      }

      function calculateMaxScore() {
        if (studentAnswers.length === 0) return 0;
        return Math.max(
          ...studentAnswers.map(
            (student) =>
              (student.answers.filter((a) => a.isCorrect).length /
                currentAssessment.questionsCount) *
              100
          )
        );
      }

      function calculateMinScore() {
        if (studentAnswers.length === 0) return 0;
        return Math.min(
          ...studentAnswers.map(
            (student) =>
              (student.answers.filter((a) => a.isCorrect).length /
                currentAssessment.questionsCount) *
              100
          )
        );
      }

      function getTopStudents(limit) {
        return studentAnswers
          .map((student) => {
            const correctAnswers = student.answers.filter(
              (a) => a.isCorrect
            ).length;
            return {
              studentName: student.studentName,
              correctAnswers,
              score: (correctAnswers / currentAssessment.questionsCount) * 100,
            };
          })
          .sort((a, b) => b.score - a.score)
          .slice(0, limit);
      }

      function calculateQuestionPerformance() {
        return Array.from(
          { length: currentAssessment.questionsCount },
          (_, i) => {
            const questionNumber = i + 1;
            const correctCount = studentAnswers.filter(
              (student) =>
                student.answers.find((a) => a.questionNumber === questionNumber)
                  ?.isCorrect
            ).length;
            const accuracy = (correctCount / studentAnswers.length) * 100;
            const subject = currentAssessment.questions.find(
              (q) => q.number === questionNumber
            ).subject;
            return { questionNumber, subject, accuracy };
          }
        );
      }

      // === Renderização de Gráficos (Otimizada) ===
      function renderChart(canvasId, type, labels, data, options) {
        const canvas = document.getElementById(canvasId);
        const ctx = canvas.getContext("2d");
        let chartInstance;

        if (canvasId === "question-chart")
          chartInstance = questionChartInstance;
        if (canvasId === "subject-chart") chartInstance = subjectChartInstance;
        if (canvasId === "student-chart") chartInstance = studentChartInstance;

        if (chartInstance) {
          chartInstance.data.labels = labels;
          chartInstance.data.datasets[0].data = data;
          chartInstance.update();
        } else {
          const newChart = new Chart(ctx, {
            type,
            data: { labels, datasets: [{ data, ...options }] },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              ...options.options,
            },
          });
          if (canvasId === "question-chart") questionChartInstance = newChart;
          if (canvasId === "subject-chart") subjectChartInstance = newChart;
          if (canvasId === "student-chart") studentChartInstance = newChart;
        }
      }

      function renderQuestionChart() {
        if (!currentAssessment || studentAnswers.length === 0) {
          document.getElementById("question-tab").innerHTML =
            "<p>Não há dados suficientes para exibir o gráfico. Adicione respostas de alunos.</p>";
          return;
        }
        const performance = calculateQuestionPerformance();
        const labels = performance.map((q) => `Q${q.questionNumber}`);
        const data = performance.map((q) => q.accuracy);
        renderChart("question-chart", "bar", labels, data, {
          label: "Taxa de Acerto (%)",
          backgroundColor: "rgba(90, 125, 255, 0.7)",
          borderColor: "rgba(90, 125, 255, 1)",
          borderWidth: 1,
          options: {
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                title: { display: true, text: "Percentual de Acertos" },
              },
            },
          },
        });
      }

      function renderSubjectChart() {
        if (!currentAssessment || studentAnswers.length === 0) {
          document.getElementById("subject-tab").innerHTML =
            "<p>Não há dados suficientes para exibir o gráfico. Adicione respostas de alunos.</p>";
          return;
        }
        const subjects = [
          ...new Set(currentAssessment.questions.map((q) => q.subject)),
        ];
        const subjectPerformance = subjects.map((subject) => {
          const subjectAnswers = studentAnswers.flatMap((student) =>
            student.answers.filter((a) => a.subject === subject)
          );
          const correctCount = subjectAnswers.filter((a) => a.isCorrect).length;
          return (correctCount / studentAnswers.length) * 100;
        });
        renderChart("subject-chart", "bar", subjects, subjectPerformance, {
          label: "Desempenho por Assunto (%)",
          backgroundColor: [
            "rgba(90, 125, 255, 0.7)",
            "rgba(23, 195, 178, 0.7)",
            "rgba(252, 203, 87, 0.7)",
            "rgba(255, 107, 107, 0.7)",
          ],
          borderColor: [
            "rgba(90, 125, 255, 1)",
            "rgba(23, 195, 178, 1)",
            "rgba(252, 203, 87, 1)",
            "rgba(255, 107, 107, 1)",
          ],
          borderWidth: 1,
          options: {
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                title: { display: true, text: "Percentual de Acertos" },
              },
            },
          },
        });
      }

      function renderStudentChart() {
        if (!currentAssessment || studentAnswers.length === 0) {
          document.getElementById("student-tab").innerHTML =
            "<p>Não há dados suficientes para exibir o gráfico. Adicione respostas de alunos.</p>";
          return;
        }
        const studentScores = getTopStudents(studentAnswers.length);
        const labels = studentScores.map((s) => s.studentName);
        const data = studentScores.map((s) => s.score);
        renderChart("student-chart", "bar", labels, data, {
          label: "Desempenho dos Alunos (%)",
          backgroundColor: "rgba(23, 195, 178, 0.7)",
          borderColor: "rgba(23, 195, 178, 1)",
          borderWidth: 1,
          options: {
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                title: { display: true, text: "Percentual de Acertos" },
              },
            },
          },
        });
      }

      function renderStudentDetails() {
        if (!currentAssessment || studentAnswers.length === 0) {
          studentDetails.innerHTML =
            "<p>Não há dados de alunos para exibir detalhes.</p>";
          return;
        }
        studentDetails.innerHTML = "<h3>Detalhes por Aluno</h3>";
        studentAnswers.forEach((student) => {
          const correctAnswers = student.answers.filter(
            (a) => a.isCorrect
          ).length;
          const score =
            (correctAnswers / currentAssessment.questionsCount) * 100;

          const studentDetail = document.createElement("div");
          studentDetail.className = "student-card";
          studentDetail.style.marginBottom = "20px";
          studentDetail.innerHTML = `
                    <h4>${student.studentName} - Nota: ${score.toFixed(1)}%</h4>
                    <p>Acertos: ${correctAnswers}/${
            currentAssessment.questionsCount
          }</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px;">
                `;

          for (let i = 1; i <= currentAssessment.questionsCount; i++) {
            const answer = student.answers.find((a) => a.questionNumber === i);
            studentDetail.innerHTML += `
                        <div style="width: 30px; height: 30px; border-radius: 5px; display: flex; align-items: center; justify-content: center; background: ${
                          answer?.isCorrect
                            ? "var(--success-color)"
                            : "var(--danger-color)"
                        }; font-size: 0.8rem;">
                            ${i}
                        </div>
                    `;
          }

          studentDetail.innerHTML += `</div>`;
          studentDetails.appendChild(studentDetail);
        });
      }

      // === Formulário Online (Mock) ===
      function generateOnlineForm() {
        if (!currentAssessment) {
          alert('Primeiro crie uma avaliação na seção "Criar Avaliação".');
          return;
        }
        if (!answerKey) {
          alert('Primeiro defina o gabarito na seção "Inserir Gabarito".');
          return;
        }

        // A lógica de criar o formulário e salvá-lo agora é no backend.
        // O frontend apenas gera o link para o formulário no backend
        const formTitle =
          document.getElementById("form-title").value || "Avaliação Online";
        const formDescription =
          document.getElementById("form-description").value ||
          "Preencha o formulário com suas respostas.";
        const requireName =
          document.getElementById("form-require-name").value === "yes";

        const formInfo = {
          assessmentId: currentAssessment._id,
          title: formTitle,
          description: formDescription,
          requireName: requireName,
        };

        // Simulação de criação do formulário no backend para obter um ID real.
        const formId = Math.random().toString(36).substring(2, 15);
        onlineFormLink = `${API_URL}/form/${formId}`;
        formLink.value = onlineFormLink;
        formLinkContainer.style.display = "block";

        renderFormPreview(formInfo);

        alert("Formulário online criado! Compartilhe o link com seus alunos.");
      }

      function renderFormPreview(formData) {
        formPreviewContainer.innerHTML = `
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px;">
                    <h2>${formData.title}</h2>
                    <p>${formData.description}</p>

                    ${
                      formData.requireName
                        ? `
                        <div class="form-group">
                            <label for="preview-student-name">Nome do Aluno</label>
                            <input type="text" id="preview-student-name" placeholder="Digite seu nome completo">
                        </div>
                    `
                        : ""
                    }

                    <div class="form-preview-questions">
                        ${currentAssessment.questions
                          .map(
                            (question) => `
                            <div class="question-preview">
                                <h4>Questão ${question.number} - ${question.subject}</h4>
                                <p>Selecione a alternativa:</p>
                                <div class="options-container">
                                    <div class="option-item">
                                        <input type="radio" name="question-${question.number}" id="preview-q${question.number}-a" value="A">
                                        <label for="preview-q${question.number}-a">A</label>
                                    </div>
                                    <div class="option-item">
                                        <input type="radio" name="question-${question.number}" id="preview-q${question.number}-b" value="B">
                                        <label for="preview-q${question.number}-b">B</label>
                                    </div>
                                    <div class="option-item">
                                        <input type="radio" name="question-${question.number}" id="preview-q${question.number}-c" value="C">
                                        <label for="preview-q${question.number}-c">C</label>
                                    </div>
                                    <div class="option-item">
                                        <input type="radio" name="question-${question.number}" id="preview-q${question.number}-d" value="D">
                                        <label for="preview-q${question.number}-d">D</label>
                                    </div>
                                    <div class="option-item">
                                        <input type="radio" name="question-${question.number}" id="preview-q${question.number}-e" value="E">
                                        <label for="preview-q${question.number}-e">E</label>
                                    </div>
                                </div>
                            </div>
                        `
                          )
                          .join("")}
                    </div>

                    <button style="margin-top: 20px;">Enviar Respostas</button>
                </div>
            `;
      }

      function copyFormLink() {
        formLink.select();
        document.execCommand("copy");
        alert("Link copiado para a área de transferência!");
      }
    </script>
  </body>
</html>
